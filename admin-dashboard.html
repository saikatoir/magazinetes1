<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Upload Magazine</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-md">
        <h1 class="text-2xl font-bold mb-6">Upload New Magazine</h1>
        <form id="uploadForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium">Magazine Title</label>
                <input type="text" id="title" required class="w-full p-2 border rounded">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium">Category</label>
                    <select id="category" class="w-full p-2 border rounded">
                        <option value="fashion">Fashion</option>
                        <option value="technology">Technology</option>
                        <option value="travel">Travel</option>
                        <option value="business">Business</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium">Release Date</label>
                    <input type="text" id="date" placeholder="Oct 2024" class="w-full p-2 border rounded">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium">Cover Image</label>
                <input type="file" id="coverFile" accept="image/*" required class="w-full">
            </div>
            <div>
                <label class="block text-sm font-medium">Magazine PDF</label>
                <input type="file" id="pdfFile" accept="application/pdf" required class="w-full">
            </div>
            <button type="submit" class="w-full bg-amber-500 text-white py-3 rounded-lg font-bold hover:bg-amber-600 transition">
                Publish to MagazineHub
            </button>
        </form>
    </div>

    <script>
        const API_URL = 'https://magazinetes1.onrender.com';

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = 'Uploading... Please wait';
            btn.disabled = true;

            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('date', document.getElementById('date').value);
            formData.append('readingTime', '15 min');
            formData.append('description', 'Freshly uploaded digital issue.');
            
            formData.append('cover', document.getElementById('coverFile').files[0]);
            formData.append('pdf', document.getElementById('pdfFile').files[0]);

            try {
                const response = await fetch(`${API_URL}/api/magazines`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    alert('Success! Magazine is now live.');
                    window.location.href = 'index.html';
                } else {
                    const err = await response.json();
                    alert('Error: ' + err.error);
                }
            } catch (error) {
                alert('Connection failed. Check if Render server is awake.');
            } finally {
                btn.innerText = 'Publish to MagazineHub';
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
