<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magazine Reader - MagazineHub</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Core Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    
    <style>
        :root {
            --primary-dark: #1a1a1a;
            --primary-light: #ffffff;
            --secondary-gray: #f8f9fa;
            --accent-cognac: #d4a574;
            --text-gray: #6b7280;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-light);
            color: var(--primary-dark);
            overflow-x: hidden;
        }
        
        .font-display {
            font-family: 'Playfair Display', serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .reader-container {
            background: linear-gradient(135deg, rgba(248, 249, 250, 0.5) 0%, rgba(212, 165, 116, 0.1) 100%);
            min-height: calc(100vh - 64px);
            
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px 0;
        }
        
        .magazine-page {
            background: white;
            height: 100vh;
            width: 100vh;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .magazine-page:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .reading-progress {
            height: 4px;
            background: rgba(212, 165, 116, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .reading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cognac), #f59e0b);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .control-button {
            transition: all 0.2s ease;
            background: white;
            border: 1px solid #e5e7eb;
        }
        
        .control-button:hover {
            background: var(--accent-cognac);
            color: white;
            border-color: var(--accent-cognac);
            transform: translateY(-2px);
        }
        
        .control-button.active {
            background: var(--accent-cognac);
            color: white;
            border-color: var(--accent-cognac);
        }
        
        .bookmark-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: var(--accent-cognac);
            border-radius: 50%;
            border: 2px solid white;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }
        
        .bookmark-indicator.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        .page-number {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-gray);
        }
        
        .reading-preferences {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }
        
        .zoom-controls {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 40;
        }
        
        .page-navigation {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
        }
        
        .search-highlight {
            background: rgba(212, 165, 116, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .related-magazines {
            background: linear-gradient(135deg, var(--secondary-gray) 0%, rgba(212, 165, 116, 0.1) 100%);
        }
        
        .magazine-content {
            line-height: 1.8;
            font-size: 16px;
        }
        
        .magazine-content h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }
        
        .magazine-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 500;
            margin: 2rem 0 1rem 0;
            color: var(--primary-dark);
        }
        
        .magazine-content p {
            margin-bottom: 1.5rem;
            color: var(--text-gray);
        }
        
        .magazine-content img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .dark-theme {
            background: var(--primary-dark);
            color: var(--primary-light);
        }
        
        .dark-theme .magazine-page {
            background: #2d2d2d;
            color: var(--primary-light);
        }
        
        .dark-theme .control-button {
            background: #3d3d3d;
            border-color: #4d4d4d;
            color: var(--primary-light);
        }
        
        .sepia-theme {
            background: #f4f1e8;
            color: #5c4b37;
        }
        
        .sepia-theme .magazine-page {
            background: #faf8f3;
            color: #5c4b37;
        }
        
        .fullscreen-mode .reader-header {
            transform: translateY(-100%);
        }
        
        .fullscreen-mode .zoom-controls,
        .fullscreen-mode .page-navigation {
            opacity: 0;
            pointer-events: none;
        }
        
        .fullscreen-mode:hover .zoom-controls,
        .fullscreen-mode:hover .page-navigation {
            opacity: 1;
            pointer-events: auto;
        }
        
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.6s ease;
        }
        /* Fullscreen styles: support both the pseudo-class and a JS toggled class */
        :fullscreen .magazine-page,
        :-webkit-full-screen .magazine-page,
        .is-fullscreen .magazine-page {
            width: 100vh;
            height: 100vh;
            max-width: none;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            padding: 32px;
            overflow: auto;
        }

        /* Keep controls accessible in fullscreen */
        :fullscreen .zoom-controls,
        :-webkit-full-screen .zoom-controls,
        .is-fullscreen .zoom-controls,
        :fullscreen .page-navigation,
        :-webkit-full-screen .page-navigation,
        .is-fullscreen .page-navigation,
        :fullscreen #searchPanel,
        :-webkit-full-screen #searchPanel,
        .is-fullscreen #searchPanel,
        :fullscreen #settingsPanel,
        :-webkit-full-screen #settingsPanel,
        .is-fullscreen #settingsPanel {
            z-index: 99999;
            opacity: 1 !important;
            pointer-events: auto !important;
        }

        /* Slightly reduce header when in fullscreen (still toggleable via hover/controls) */
        :fullscreen .reader-header,
        :-webkit-full-screen .reader-header,
        .is-fullscreen .reader-header {
            transform: translateY(-100%);
        }
    </style>
</head>
<body>
    <!-- Reader Header -->
    <header class="reader-header fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-md border-b border-gray-100 transition-transform duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Back Button -->
                <div class="flex items-center space-x-4">
                    <button onclick="history.back()" class="flex items-center space-x-2 text-gray-600 hover:text-amber-600 transition-colors">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        <span class="text-sm font-medium">Back to Library</span>
                    </button>
                    <div class="h-4 w-px bg-gray-200"></div>
                    <h1 class="font-display text-lg font-semibold text-gray-900">Vogue Fashion Weekly</h1>
                </div>
                
                <!-- Reading Progress -->
                <div class="flex-1 max-w-md mx-8">
                    <div class="reading-progress">
                        <div class="reading-progress-bar" style="width: 35%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Page 7 of 20</span>
                        <span>35% Complete</span>
                    </div>
                </div>
                
                <!-- Reader Controls -->
                <div class="flex items-center space-x-2">
                    <button id="searchBtn" class="control-button p-2 rounded-lg" title="Search in magazine">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                    <button id="bookmarkBtn" class="control-button p-2 rounded-lg relative" title="Bookmark page">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        <div class="bookmark-indicator"></div>
                    </button>
                    <button id="settingsBtn" class="control-button p-2 rounded-lg" title="Reading settings">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                    <button id="fullscreenBtn" class="control-button p-2 rounded-lg" title="Toggle fullscreen">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Reader Content -->
    <main class="reader-container">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Magazine Content -->
            <div class="magazine-page p-8 mb-8" id="magazineContent">
                <article class="magazine-content">
                    <h1>The Future of Sustainable Fashion</h1>
                    
                    <p class="text-lg text-gray-600 mb-6">Exploring how luxury brands are embracing environmental responsibility without compromising on style and quality.</p>
                    
                    <img src="resources/mag-covers/fashion-01.jpg" alt="Sustainable Fashion Editorial" class="w-full h-64 object-cover">
                    
                    <h2>The Green Revolution in Fashion</h2>
                    
                    <p>The fashion industry is undergoing a transformative shift toward sustainability, driven by consumer demand and environmental necessity. Leading luxury brands are reimagining their production processes, from sourcing organic materials to implementing circular economy principles.</p>
                    
                    <p>Stella McCartney has been a pioneer in sustainable luxury fashion, demonstrating that ethical practices and high design can coexist. The brand's commitment to vegetarian materials and innovative alternatives to leather has inspired the entire industry.</p>
                    
                    <p>Similarly, Gucci's Equilibrium initiative showcases how major fashion houses can reduce their environmental footprint while maintaining their signature aesthetic. The program focuses on carbon neutrality, sustainable sourcing, and innovative materials research.</p>
                    
                    <h2>Innovative Materials and Technologies</h2>
                    
                    <p>The development of lab-grown leather, recycled textiles, and bio-fabricated materials represents a new frontier in sustainable fashion. Companies like Bolt Threads are creating leather alternatives from mycelium, while Econyl transforms ocean plastic into luxury nylon.</p>
                    
                    <p>These innovations are not just environmentally consciousâ€”they're creating new possibilities for design and functionality. The future of fashion lies in materials that are both beautiful and sustainable, proving that luxury and responsibility can go hand in hand.</p>
                    
                    <h2>Consumer Consciousness and Market Trends</h2>
                    
                    <p>Today's consumers are increasingly aware of the environmental impact of their fashion choices. This consciousness is driving demand for transparency in supply chains and ethical production practices.</p>
                    
                    <p>The resale market is booming, with platforms like Vestiaire Collective and The RealReal making luxury fashion more accessible while promoting circular consumption. This trend represents a fundamental shift in how we think about fashion ownership and sustainability.</p>
                    
                    <p>As we look to the future, sustainable fashion will no longer be a niche market but the standard for the entire industry. The brands that embrace this change will not only survive but thrive in a more conscious marketplace.</p>
                </article>
            </div>
        </div>
    </main>

    <!-- Zoom Controls -->
    <div class="zoom-controls space-y-2">
        <button class="control-button p-3 rounded-lg block w-full" id="zoomIn" title="Zoom In">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
        </button>
        <button class="control-button p-3 rounded-lg block w-full" id="zoomOut" title="Zoom Out">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
            </svg>
        </button>
        <button class="control-button p-3 rounded-lg block w-full" id="fitWidth" title="Fit to Width">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
            </svg>
        </button>
    </div>

    <!-- Page Navigation -->
    <div class="page-navigation">
        <div class="flex items-center space-x-4 bg-white/95 backdrop-blur-md rounded-full px-6 py-3 border border-gray-100">
            <button id="prevPage" class="control-button p-2 rounded-full" title="Previous Page">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <div class="flex items-center space-x-2">
                <input type="number" id="pageInput" value="7" min="1" max="20" class="w-16 text-center border border-gray-200 rounded text-sm page-number">
                <span class="text-gray-500 page-number">of 20</span>
            </div>
            <button id="nextPage" class="control-button p-2 rounded-full" title="Next Page">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Search Panel -->
    <div id="searchPanel" class="fixed top-16 right-4 w-80 bg-white rounded-lg shadow-lg border border-gray-100 p-4 z-40 hidden">
        <div class="flex items-center space-x-2 mb-4">
            <input type="text" id="searchInput" placeholder="Search in magazine..." class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-400">
            <button id="closeSearch" class="p-2 text-gray-400 hover:text-gray-600">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div id="searchResults" class="space-y-2 max-h-60 overflow-y-auto">
            <!-- Search results will appear here -->
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="fixed top-16 right-4 w-80 reading-preferences rounded-lg shadow-lg p-4 z-40 hidden">
        <div class="flex items-center justify-between mb-4">
            <h3 class="font-medium text-gray-900">Reading Preferences</h3>
            <button id="closeSettings" class="p-1 text-gray-400 hover:text-gray-600">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Theme</label>
                <div class="grid grid-cols-3 gap-2">
                    <button class="theme-btn active px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white" data-theme="light">Light</button>
                    <button class="theme-btn px-3 py-2 text-sm border border-gray-200 rounded-lg bg-gray-800 text-white" data-theme="dark">Dark</button>
                    <button class="theme-btn px-3 py-2 text-sm border border-gray-200 rounded-lg bg-yellow-50 text-yellow-900" data-theme="sepia">Sepia</button>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Font Size</label>
                <input type="range" id="fontSizeSlider" min="14" max="24" value="16" class="w-full">
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>Small</span>
                    <span>Large</span>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Line Height</label>
                <input type="range" id="lineHeightSlider" min="1.4" max="2.0" step="0.1" value="1.8" class="w-full">
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>Tight</span>
                    <span>Loose</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Magazines -->
    <section class="related-magazines py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="font-display text-2xl font-semibold text-gray-900 mb-6">Related Magazines</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="magazine-card bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <img src="resources/mag-covers/fashion-02.jpg" alt="Elle Magazine" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-medium text-gray-900">Elle</h3>
                        <p class="text-sm text-gray-600">Fashion & Lifestyle</p>
                    </div>
                </div>
                <div class="magazine-card bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <img src="resources/mag-covers/lifestyle-01.jpg" alt="Harper's Bazaar" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-medium text-gray-900">Harper's Bazaar</h3>
                        <p class="text-sm text-gray-600">Luxury Fashion</p>
                    </div>
                </div>
                <div class="magazine-card bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <img src="resources/mag-covers/art-01.jpg" alt="Modern Art Quarterly" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-medium text-gray-900">Modern Art Quarterly</h3>
                        <p class="text-sm text-gray-600">Art & Design</p>
                    </div>
                </div>
                <div class="magazine-card bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <img src="resources/mag-covers/lifestyle-01.jpg" alt="Kinfolk" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-medium text-gray-900">Kinfolk</h3>
                        <p class="text-sm text-gray-600">Lifestyle & Culture</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-sm text-gray-600">
                <p>&copy; 2024 MagazineHub. Free digital magazine reading platform.</p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        const API_URL = 'https://magazinetes1.onrender.com';

async function loadMagazine() {
    const urlParams = new URLSearchParams(window.location.search);
    const magId = urlParams.get('id');

    if (!magId) return;

    try {
        // Fetch the specific magazine details
        const response = await fetch(`${API_URL}/api/magazines`);
        const magazines = await response.json();
        const mag = magazines.find(m => m.id == magId);

        if (mag && mag.pdf_path) {
            // Update the iframe or viewer with the PDF URL
            const pdfUrl = `${API_URL}${mag.pdf_path}`;
            document.getElementById('pdfViewer').src = pdfUrl;
            document.getElementById('readerTitle').textContent = mag.title;
        }
    } catch (err) {
        console.error("Could not load PDF:", err);
    }
}

document.addEventListener('DOMContentLoaded', loadMagazine);
        (function () {
            function isFullscreenActive() {
                return !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
            }

            var fsBtn = document.getElementById('fullscreenBtn');
            var root = document.documentElement;

            function onFullscreenChange() {
                if (isFullscreenActive()) {
                    root.classList.add('is-fullscreen');
                    if (fsBtn) fsBtn.classList.add('active');
                } else {
                    root.classList.remove('is-fullscreen');
                    if (fsBtn) fsBtn.classList.remove('active');
                }
            }

            function enterFullscreen() {
                var el = document.documentElement;
                if (el.requestFullscreen) return el.requestFullscreen();
                if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
                if (el.mozRequestFullScreen) return el.mozRequestFullScreen();
                if (el.msRequestFullscreen) return el.msRequestFullscreen();
                return Promise.resolve();
            }

            function exitFullscreen() {
                if (document.exitFullscreen) return document.exitFullscreen();
                if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
                if (document.mozCancelFullScreen) return document.mozCancelFullScreen();
                if (document.msExitFullscreen) return document.msExitFullscreen();
                return Promise.resolve();
            }

            if (fsBtn) {
                fsBtn.addEventListener('click', function () {
                    if (isFullscreenActive()) exitFullscreen(); else enterFullscreen();
                });
            }

            document.addEventListener('fullscreenchange', onFullscreenChange);
            document.addEventListener('webkitfullscreenchange', onFullscreenChange);
            document.addEventListener('mozfullscreenchange', onFullscreenChange);
            document.addEventListener('MSFullscreenChange', onFullscreenChange);

            // Keyboard shortcuts: 'f' toggles fullscreen, arrows navigate pages
            document.addEventListener('keydown', function (e) {
                var tag = (e.target && e.target.tagName) || '';
                if (tag === 'INPUT' || tag === 'TEXTAREA') return;
                if (e.key === 'f' || e.key === 'F') {
                    e.preventDefault();
                    if (isFullscreenActive()) exitFullscreen(); else enterFullscreen();
                } else if (e.key === 'ArrowRight') {
                    var next = document.getElementById('nextPage');
                    if (next) next.click();
                } else if (e.key === 'ArrowLeft') {
                    var prev = document.getElementById('prevPage');
                    if (prev) prev.click();
                }
            });

            // Ensure initializeReader is still called
            if (typeof initializeReader === 'function') {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', initializeReader);
                } else {
                    try { initializeReader(); } catch (e) { /* ignore */ }
                }
            }
        })();
    </script>
</body>

</html>
